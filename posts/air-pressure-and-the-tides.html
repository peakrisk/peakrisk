<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Exploring tides in the atmosphere">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Air pressure and the tides | Peak Risk</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://peakrisk.github.io/peakrisk/posts/air-pressure-and-the-tides.html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="John Gill">
<meta property="og:site_name" content="Peak Risk">
<meta property="og:title" content="Air pressure and the tides">
<meta property="og:url" content="http://peakrisk.github.io/peakrisk/posts/air-pressure-and-the-tides.html">
<meta property="og:description" content="Exploring tides in the atmosphere">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-07-05T02:25:29+00:00">
<meta property="article:tag" content="air pressure">
<meta property="article:tag" content="astropy">
<meta property="article:tag" content="moon">
<meta property="article:tag" content="pyephem">
<meta property="article:tag" content="python">
<meta property="article:tag" content="tides">
<meta property="article:tag" content="weather">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top" role="navigation"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://peakrisk.github.io/peakrisk/">

                <span id="blog-title">Peak Risk</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
<li>
<a href="../blog/">Blog</a>
                </li>
<li>
<a href="../archive.html">Archive</a>
                </li>
<li>
<a href="../categories/index.html">Tags</a>
                </li>
<li>
<a href="../galleries/">Galleries</a>
                </li>
<li>
<a href="../stories/contributors.html">Contributors</a>
                </li>
<li>
<a href="../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="air-pressure-and-the-tides.ipynb" id="sourcelink">Source</a>
    </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Air pressure and the tides</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">John Gill</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-07-05T02:25:29+00:00" itemprop="datePublished" title="2015-07-05 02:25">2015-07-05 02:25</time></a></p>
                <p class="commentline">            <a href="air-pressure-and-the-tides.html#disqus_thread" data-disqus-identifier="cache/posts/air-pressure-and-the-tides.html">Comments</a>


                    </p>
<p class="sourceline"><a href="air-pressure-and-the-tides.ipynb" id="sourcelink">Source</a></p>

                <meta name="description" itemprop="description" content="Exploring tides in the atmosphere">
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I am really enjoying having this weather station.  I say weather
station, but it is just a raspberry pi with a pressure and temperature
sensor attached to it.
Computers are versatile, you can run any software on them, so they can
do a lot of different things.</p>
<p>But the pi takes this to a whole different level.  They are $40 or so,
depending on taxes and stuff.  Now you need a whole bunch of other
stuff: leads, keyboards, sensors, cameras, touch screens and lots more.</p>
<p>I have been using <a href="#">Adafruit</a>.  They have been very helpful with orders.</p>
<p>I found browsing for parts and finding what I needed to get started
with the weather stuff a bit confusing for a while.</p>
<p>I had other stuff to do anyway, I needed to get used to just
installing software on them and setting up environments where I can
figure out how things are working.</p>
<p>I found a great <a href="#">posting</a> about building a weather station, with
enough detail I thought I would be able to work through it.</p>
<p>I order a cheap humidity sensor ($5) that also should do temperature.
I haven't got it working yet, not sure if it is hardware or software.
Meanwhile, I now have a better sensor.  The humidity here is often
outside the range the cheaper sensor is supposed to work.</p>
<p>The good thing is that I should be able to find a use for it at some point.</p>
<p>I also have a camera for this thing and a touchscreen.  I am thinking
of trying to combine them to make a camera.</p>
<p>The one on my phone can do some neat stuff, but the interface keeps
changing and not in ways that are making things easier.</p>
<p>The night skies have been spectacular of late, with Venus and Jupiter
close together in the early evening sky to the west.  If you see two
bright stars after sunset, that is probably them.</p>
<p>Then the moon is just past full.  Here in Bermuda there is often
cloud, not heavy, but patchy clouds.  The humidity is often very high,
so the atmosphere is interesting.</p>
<p>The best sunsets usually have some clouds for the setting sun to
reflect off.  The same with sunrises.</p>
<p>And the full moon too.  Tonight it rose behind cloud.  Last night it
was clearer and it rose orange/red.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Back-to-weather">Back to weather<a class="anchor-link" href="air-pressure-and-the-tides.html#Back-to-weather">¶</a>
</h4>
<p>Since I got this thing working it has been hot and settled weather.
There is a strong Bermuda high in place.  Someone described it to me
as like a pit-bull, once it gets hold it does not let go.  So, we may
be in for a long hot spell.</p>
<p>With the pressure changing quite smoothly, the plots I created still
showed quite an interesting pattern.</p>
<p>Skip the next bit, or go back to the earlier <a href="#">post</a>, it is just
setting things up to do some plotting.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Tell matplotlib to plot in line</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c"># import pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c"># seaborn magically adds a layer of goodness on top of Matplotlib</span>
<span class="c"># mostly this is just changing matplotlib defaults, but it does also</span>
<span class="c"># provide some higher level plotting methods.</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="c"># Tell seaborn to set things up</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    
    <span class="n">means</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="n">thresh</span>
    
    <span class="n">delta</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
    
    <span class="n">good</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">sds</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">good</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">delta</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">good</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># set the path to the file we are going to analyse</span>
<span class="n">infile</span> <span class="o">=</span> <span class="s">"../files/light.csv"</span>

<span class="o">!</span>scp 192.168.0.133:Adafruit_Python_BMP/light.csv ../files
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>light.csv                                     100% 1625KB   1.6MB/s   00:00    
light.csv                                       0%    0     0.0KB/s   --:-- ETA</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="sd">""" assume it is csv and let pandas do magic</span>

<span class="sd">  index_col tells it to use the 'date' column in the data</span>
<span class="sd">  as the row index, plotting picks up on this and uses the</span>
<span class="sd">  date on the x-axis</span>

<span class="sd">  The *parse_dates* bit just tells it to try and figure out</span>
<span class="sd">  the date/time in the columne labeled 'date'.</span>
<span class="sd">"""</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'date'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s">'date'</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># incantation to extract the first record in the data</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s">'temp'</span><span class="p">,</span> <span class="s">'altitude'</span><span class="p">]]</span><span class="o">.</span><span class="n">irow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># smooth the data to filter out bad temps and pressures</span>
<span class="n">sdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">smooth</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>

<span class="c"># now use smooth to throw away dodgy data, and plot the temp and altitude fieldsa</span>
<span class="n">sdata</span><span class="p">[[</span><span class="s">'temp'</span><span class="p">,</span> <span class="s">'altitude'</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6c7f7a20&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[26]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6c53f7f0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6c2cef98&gt;], dtype=object)</pre>
</div>

</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>               temp      pressure      altitude  sealevel_pressure
count  24297.000000  12920.000000  24073.000000       13027.000000
mean       0.000004      0.016409      0.000661          -0.000230
std        0.032970      2.459936      0.515331           2.456391
min       -0.100000     -4.000000     -2.330888          -4.000000
25%        0.000000     -2.000000     -0.331813          -2.000000
50%        0.000000      0.000000      0.000000           0.000000
75%        0.000000      2.000000      0.331889           2.000000
max        0.100000      4.000000      2.748358           4.000000
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Temperature">Temperature<a class="anchor-link" href="air-pressure-and-the-tides.html#Temperature">¶</a>
</h4>
<p>The temperature plot shows a steady up and down, warming during the
days, cooling a little, but only 2C at night.</p>
<p>There is one day, where I think we had some thunder storms where it dropped during the day.</p>
<p>The last week or so the temperature has been steadily climbing.</p>
<h4 id="Pressure">Pressure<a class="anchor-link" href="air-pressure-and-the-tides.html#Pressure">¶</a>
</h4>
<p>The Pressure also shows slow drifting up and down.  But there is this
other strange ripple up and down.</p>
<p>I mentioned this to a meteorologist and immediately got the reply that
it was because the atmosphere is tidal.</p>
<p>So the pattern we see in the pressure should be driven largely by the moon.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">astropy</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">find_api_page</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># find_api_page is handy, even opens a browser windo.</span>

<span class="c">#find_api_page(units)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># astropy is cool, but I need data for the moon.  Let's try pyephem</span>

<span class="c"># uncommented the line below and run this cell if you need to install using</span>
<span class="c"># pip.  This will install into the environment that is being used to run your</span>
<span class="c"># ipython notebook server.</span>

<span class="c">#!pip install pyephem</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">ephem</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Create a Moon</span>

<span class="n">moon</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Tell it to figure out where it is</span>
<span class="n">moon</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="c"># pring out the phase</span>
<span class="n">moon</span><span class="o">.</span><span class="n">phase</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">moon_orbitals</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">""" Given an index of times create a DataFrame of moon orbitals</span>
<span class="sd">    </span>
<span class="sd">    For now, just Phase, geocentric latitude and geocentric longitude</span>
<span class="sd">    """</span>
    
    <span class="c"># Create dataframe with index as the index</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c"># Add three series</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'phase'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'glat'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'glon'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    
    <span class="c"># Now generate the data</span>
    <span class="c"># NB this is slow, solpy might work out faster</span>
    <span class="n">moon</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        
        <span class="c"># Compute the moon posigion</span>
        <span class="n">moon</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M:%S"</span><span class="p">))</span>
        
        <span class="n">df</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">phase</span>
        <span class="n">df</span><span class="o">.</span><span class="n">glat</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">hlat</span>
        <span class="n">df</span><span class="o">.</span><span class="n">glon</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">hlon</span>
        
    <span class="k">return</span> <span class="n">df</span>
        
        
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># See what we got</span>

<span class="n">moon</span> <span class="o">=</span> <span class="n">moon_orbitals</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">moon</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[30]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>              phase          glat          glon
count  24390.000000  24390.000000  24390.000000
mean      71.811609      0.030610      3.590249
std       25.825346      0.051875      2.041656
min       12.998277     -0.078916      0.000126
25%       55.731966     -0.007763      1.029049
50%       79.226440      0.045898      4.204486
75%       94.245584      0.076175      5.220167
max       99.811104      0.087505      6.283139</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">moon</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6c82eeb8&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6c3bf4e0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6c3df358&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6c319c18&gt;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Try feeding in a longer time series</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'7/7/2015'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">560</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">moon_orbitals</span><span class="p">(</span><span class="n">days</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6ec1feb8&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6e3f6a58&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6e32fa20&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f6e96d978&gt;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sdata</span><span class="p">[</span><span class="s">'moon_phase'</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">phase</span>
<span class="n">sdata</span><span class="p">[</span><span class="s">'moon_glat'</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">glat</span>
<span class="n">sdata</span><span class="p">[</span><span class="s">'moon_glon'</span><span class="p">]</span> <span class="o">=</span> <span class="n">moon</span><span class="o">.</span><span class="n">glon</span>

<span class="c"># FIXME -- must be a pandas one liner eg data += moon ?</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sdata</span><span class="p">[[</span><span class="s">'temp'</span><span class="p">,</span> <span class="s">'altitude'</span><span class="p">,</span> <span class="s">'moon_phase'</span><span class="p">,</span> <span class="s">'moon_glon'</span><span class="p">,</span> <span class="s">'moon_glat'</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6c42d550&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[33]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f679f7f60&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f67bdd240&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f67ba4a20&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f67b5d860&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f5f67b2b080&gt;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The latitude is almost in phase with the phase of the moon, at least at the moment.</p>
<p>Next job is to add these series to our data frame and then take a look at scikit-learn</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span><span class="n">sdata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sdata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="p">(</span><span class="n">sdata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mf">60.</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[34]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>15.116666666666667</pre>
</div>

</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2015-06-25 15:07:37.174400
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sdata</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[35]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>           altitude  pressure  sealevel_pressure          temp    moon_phase  \
count  24390.000000         0                  0  24390.000000  24390.000000   
mean     -38.176001       NaN                NaN     29.239996     71.811609   
std       17.949836       NaN                NaN      0.816808     25.825346   
min      -69.792586       NaN                NaN     27.200000     12.998277   
25%      -52.066411       NaN                NaN     28.700000     55.731966   
50%      -42.701518       NaN                NaN     29.300000     79.226440   
75%      -28.683335       NaN                NaN     29.800000     94.245584   
max        8.379000       NaN                NaN     31.100000     99.811104   

          moon_glat     moon_glon  
count  24390.000000  24390.000000  
mean       0.030610      3.590249  
std        0.051875      2.041656  
min       -0.078916      0.000126  
25%       -0.007763      1.029049  
50%        0.045898      4.204486  
75%        0.076175      5.220167  
max        0.087505      6.283139  </pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">tide_proxy</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c"># Create dataframe with index as the index</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
        <span class="n">hour_min</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mf">60.</span><span class="p">)</span>
	
        <span class="n">hour_min</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">moon_glat</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

        <span class="n">series</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_min</span>
        
    <span class="k">return</span> <span class="n">series</span>
        
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">xx</span> <span class="o">=</span> <span class="n">tide_proxy</span><span class="p">(</span><span class="n">sdata</span><span class="p">)</span>

<span class="n">xx</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">xx</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6c8f27b8&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>count    23229.000000
mean        12.076573
std          6.913170
min         -0.058869
25%          6.086867
50%         12.146825
75%         18.029911
max         24.070675
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># See what we got</span>
<span class="n">moon</span> <span class="o">=</span> <span class="n">moon_orbitals</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">moon</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[17]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>              phase          glat          glon
count  23229.000000  23229.000000  23229.000000
mean      74.594760      0.035876      3.715151
std       23.181442      0.047355      2.012164
min       19.451408     -0.070132      0.000126
25%       61.817314      0.005469      0.981197
50%       80.961258      0.049373      4.296528
75%       94.750534      0.077198      5.270589
max       99.811104      0.087505      6.283139</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sdata</span><span class="p">[</span><span class="s">'tide'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tide_proxy</span><span class="p">(</span><span class="n">sdata</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'altitude'</span><span class="p">,</span> <span class="s">'temp'</span><span class="p">,</span> <span class="s">'tide'</span><span class="p">]</span>

<span class="n">sdata</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f67684ef0&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[38]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f5f678cc5f8&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sdata</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7f5f6c1e82b0&gt;</pre>
</div>

</div>

<div class="output_area">
<div class="prompt output_prompt">Out[39]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f5f674d38d0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"../files/moon_weather.csv"</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
     <span class="n">sdata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../categories/air-pressure.html" rel="tag">air pressure</a></li>
            <li><a class="tag p-category" href="../categories/astropy.html" rel="tag">astropy</a></li>
            <li><a class="tag p-category" href="../categories/moon.html" rel="tag">moon</a></li>
            <li><a class="tag p-category" href="../categories/pyephem.html" rel="tag">pyephem</a></li>
            <li><a class="tag p-category" href="../categories/python.html" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../categories/tides.html" rel="tag">tides</a></li>
            <li><a class="tag p-category" href="../categories/weather.html" rel="tag">weather</a></li>
        </ul>
<ul class="pager">
<li class="previous">
                <a href="jupyter-venus-the-moon-and-gibbs-hill-weather.html" rel="prev" title="Jupyter, Venus, the Moon and Gibbs Hill weather">Previous post</a>
            </li>
            <li class="next">
                <a href="lamp-and-limp-stacks.html" rel="next" title="LAMP and LIMP stacks">Next post</a>
            </li>
        </ul></nav></aside><section class="comments"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="peakrisk",
            disqus_url="http://peakrisk.github.io/peakrisk/posts/air-pressure-and-the-tides.html",
        disqus_title="Air pressure and the tides",
        disqus_identifier="cache/posts/air-pressure-and-the-tides.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="peakrisk";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer>
            Contents © 2015         <a href="mailto:swfiua@gmail.com">John Gill</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>

            
        </footer>
</div>
</div>

            <script src="../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
